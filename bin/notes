#!/bin/bash

# Default notes directory
DEFAULT_NOTES_DIR="$HOME/Documents/Notes"

# Note file extension
NOTE_EXTENSION=".md"

# Preferred text editor
EDITOR="${EDITOR:-vim}" # Use $EDITOR environment variable if set, otherwise default to vim

# Always use the default notes directory
NOTES_DIR="$DEFAULT_NOTES_DIR"

# Create the notes directory if it doesn't exist
if [ ! -d "$NOTES_DIR" ]; then
  if ! mkdir -p "$NOTES_DIR"; then
    echo "Error creating notes directory: $NOTES_DIR" >&2
    exit 1
  fi
  echo "Created notes directory: $NOTES_DIR"
fi

# Create and open the daily note
open_daily_note() {
  # Use daily folder structure
  local daily_dir="$NOTES_DIR/daily"
  local year
  local month
  local day
  year=$(date +%Y)
  month=$(date +%m)
  day=$(date +%d)
  local daily_note_name="$year-$month-$day$NOTE_EXTENSION" # e.g., 2024-10-27.md
  local daily_note_path="$daily_dir/$daily_note_name"

  # Create daily directory if it doesn't exist
  if [ ! -d "$daily_dir" ]; then
    if ! mkdir -p "$daily_dir"; then
      echo "Error creating daily note directory: $daily_dir" >&2
      exit 1
    fi
  fi

  echo "Opening daily note: $daily_note_path"

  # Create the file with a timestamp if it doesn't exist
  if [ ! -f "$daily_note_path" ]; then
    echo "# Daily Note - $(date)" >"$daily_note_path"
  fi

  # Open the note in the editor
  cd "$NOTES_DIR" || exit
  "$EDITOR" "$daily_note_path"
}

# Open the daily note
open_daily_note

exit 0
