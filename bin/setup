#!/bin/sh

# Welcome to the Alessio Rocco laptop script!
# Be prepared to turn your laptop (or desktop, no haters here)
# into an awesome development machine.
# Thanks to https://github.com/thoughtbot/laptop

fancy_echo() {
  local fmt="$1"; shift

  # shellcheck disable=SC2059
  printf "\\n$fmt\\n" "$@"
}

# Add a failed message if setup fails.
# shellcheck disable=SC2154
trap 'ret=$?; test $ret -ne 0 && printf "\nSetup failed!\n\n" >&2; exit $ret' EXIT

# Exit immediately if a command exits with a non-zero status.
set -e

fancy_echo 'Applying MacOS configurations ...'

# Map 'caps lock' key to 'control'
hidutil property --set '{"UserKeyMapping":[{"HIDKeyboardModifierMappingSrc":0x700000039,"HIDKeyboardModifierMappingDst":0x7000000E0}]}' >/dev/null

# Dock configurations

## Show only active apps.
defaults write com.apple.dock static-only -bool TRUE

## Automatically hide and show the Dock.
defaults write com.apple.dock autohide -bool TRUE

## Set Dock position to the left of the screen.
defaults write com.apple.dock orientation left

## Restart the Dock to apply the changes
killall Dock

# Install Homebrew if the brew command is not found
if ! command -v brew >/dev/null; then
  fancy_echo "Installing Homebrew ..."

  curl -fsS \
    'https://raw.githubusercontent.com/Homebrew/install/master/install' | ruby
fi

# Upgrade Homebrew and install or upgrade formulae
fancy_echo "Updating Homebrew formulae ..."
brew update
brew bundle --file=- <<EOF

# Tools
brew "fish"

EOF

fancy_echo 'Setup completed!'
